<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body><pre>array (
  'item' => 0,
  'town' => '0',
  'keyword' => 'ТЕКНИК ЭКСПО',
  'user' => 'guest',
  'new_firm_id' => 0,
  'new_firm_name' => '',
  'new_firm_item_name' => '',
  'query_str' => 'ТЕКНИК|ЭКСПО',
)<hr>array (
  0 => 
  array (
    'query' => 'set @keylist = ucase(?)',
    'values' => 
    array (
      0 => 's',
      1 => 'ТЕКНИК|ЭКСПО',
    ),
    'affected_rows' => 0,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 1,
    'field_count' => 0,
    'Execution time' => 0,
    'Transfer time' => 0,
  ),
  1 => 
  array (
    'query' => 'set @key=\'\'',
    'values' => 
    array (
    ),
    'affected_rows' => 0,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 0,
    'Execution time' => 0,
    'Transfer time' => 0,
  ),
  2 => 
  array (
    'query' => 'create temporary table keywords
select @key:=substr(@keylist,1,instr(concat(@keylist,\'|\'),\'|\')-1) keyword,
       @keylist:=substr(@keylist,instr(concat(@keylist,\'|\'),\'|\')+1,255) dummy
  from  firm
 where @keylist!=\'\'',
    'values' => 
    array (
    ),
    'affected_rows' => 2,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 0,
    'Execution time' => 0.1669921875,
    'Transfer time' => 0,
  ),
  3 => 
  array (
    'query' => 'delete from keywords where char_length(keyword)<3',
    'values' => 
    array (
    ),
    'affected_rows' => 0,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 0,
    'Execution time' => 0.00097680091857910156,
    'Transfer time' => 0,
  ),
  4 => 
  array (
    'query' => 'create temporary table fresult
as
select max(if(char_length(?)<3,1,relevance(upper(?),concat_ws(\' \',firm_name,item_name,address,phone)))) as relevance,               
               firm_id
          from vfirm
          left join keywords k on concat_ws(\' \',firm_name,item_name,address,phone) like concat(\'%\',k.keyword,\'%\')
         where (town_id=? or ?=0)
           and (item_id=? or ?=0)
           and (char_length(?)<3 or k.keyword is not null)
 group by firm_id
having max(if(char_length(?)<3,1,relevance(upper(?),concat_ws(\' \',firm_name,item_name,address,phone))))>0
 order by 1 desc
 limit 100; ',
    'values' => 
    array (
      0 => 'ssddiisss',
      1 => 'ТЕКНИК|ЭКСПО',
      2 => 'ТЕКНИК|ЭКСПО',
      3 => '0',
      4 => '0',
      5 => 0,
      6 => 0,
      7 => 'ТЕКНИК|ЭКСПО',
      8 => 'ТЕКНИК|ЭКСПО',
      9 => 'ТЕКНИК|ЭКСПО',
    ),
    'affected_rows' => 5,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 9,
    'field_count' => 0,
    'Execution time' => 1.0830080509185791,
    'Transfer time' => 0,
  ),
  5 => 
  array (
    'query' => 'select f.*
  from fresult r
 inner join firm f on f.firm_id=r.firm_id
order by r.relevance desc,f.firm_name;',
    'values' => 
    array (
    ),
    'affected_rows' => 5,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 3,
    'Execution time' => 0.00097608566284179688,
    'Transfer time' => 0,
  ),
  6 => 
  array (
    'query' => 'select r.firm_id,c.*
  from fresult r
 inner join firm_div d on d.firm_id=r.firm_id
 inner join catalog_item c on c.item_id=d.item_id',
    'values' => 
    array (
    ),
    'affected_rows' => 17,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 3,
    'Execution time' => 0.00097584724426269531,
    'Transfer time' => 0,
  ),
  7 => 
  array (
    'query' => 'SELECT r.firm_id,t.town_name, s.street_name, CONCAT (a.building,bletter) building,  CONCAT (a.office,oletter) office
  from fresult r
 INNER JOIN firm_address a ON a.firm_id=r.firm_id
 INNER JOIN street s ON a.street_id=s.street_id
 INNER JOIN town t ON s.town_id=t.town_id
order by 2,3,4,5',
    'values' => 
    array (
    ),
    'affected_rows' => 1,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 5,
    'Execution time' => 0.00097703933715820312,
    'Transfer time' => 0,
  ),
  8 => 
  array (
    'query' => 'select p.*
  from fresult r
 inner join firm_phone p on p.firm_id=r.firm_id
order by phone_code,phone_number;',
    'values' => 
    array (
    ),
    'affected_rows' => 5,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 6,
    'Execution time' => 0.00097703933715820312,
    'Transfer time' => 0,
  ),
)<hr>array (
  'sync' => 
  array (
    0 => 
    array (
      'firms' => 'true',
    ),
  ),
  'state' => 
  array (
    'item' => 0,
    'town' => '0',
    'keyword' => 'ТЕКНИК ЭКСПО',
    'user' => 'guest',
    'new_firm_id' => 0,
    'new_firm_name' => '',
    'new_firm_item_name' => '',
    'query_str' => 'ТЕКНИК|ЭКСПО',
  ),
  'nodes' => 
  array (
    'firms' => 
    array (
      0 => 
      array (
        'firm' => 
        array (
          'firm_id' => 9291,
          'firm_name' => 'ТЕКНИК ЭКСПО, ТОО',
          'firm_descr' => '',
        ),
      ),
      1 => 
      array (
        'firm' => 
        array (
          'firm_id' => 10082,
          'firm_name' => 'ХОЛОД - ЭКСПО, ТОО',
          'firm_descr' => '',
        ),
      ),
      2 => 
      array (
        'firm' => 
        array (
          'firm_id' => 3819,
          'firm_name' => 'ВОСТОК АВТО ЭКСПОРТ, ТОО',
          'firm_descr' => '',
        ),
      ),
      3 => 
      array (
        'firm' => 
        array (
          'firm_id' => 5901,
          'firm_name' => 'КОМПАНИЯ АРСЕНАЛ ЭКСПОРТ, ТОО',
          'firm_descr' => '',
        ),
      ),
      4 => 
      array (
        'firm' => 
        array (
          'firm_id' => 8090,
          'firm_name' => 'РАХАТ, ЭКСПОЦЕНТР',
          'firm_descr' => '',
        ),
      ),
      5 => 
      array (
        'item' => 
        array (
          'firm_id' => 9291,
          'item_id' => 243,
          'item_name' => 'МАТЕРИАЛЬНО - ТЕХНИЧЕСКОЕ ОБЕСПЕЧЕНИЕ',
        ),
      ),
      6 => 
      array (
        'item' => 
        array (
          'firm_id' => 9291,
          'item_id' => 287,
          'item_name' => 'ОБОРУДОВАНИЕ ПРОМЫШЛЕННОЕ',
        ),
      ),
      7 => 
      array (
        'item' => 
        array (
          'firm_id' => 9291,
          'item_id' => 289,
          'item_name' => 'ОБОРУДОВАНИЕ ТЕХНОЛОГИЧЕСКОЕ',
        ),
      ),
      8 => 
      array (
        'item' => 
        array (
          'firm_id' => 9291,
          'item_id' => 469,
          'item_name' => 'ХИМИЧЕСКИЕ РЕАКТИВЫ, ПОСУДА',
        ),
      ),
      9 => 
      array (
        'item' => 
        array (
          'firm_id' => 10082,
          'item_id' => 178,
          'item_name' => 'ИНСТРУМЕНТЫ РАЗЛИЧНЫЕ',
        ),
      ),
      10 => 
      array (
        'item' => 
        array (
          'firm_id' => 10082,
          'item_id' => 188,
          'item_name' => 'КАНАЛИЗАЦИОННОЕ ОБОРУДОВАНИЕ',
        ),
      ),
      11 => 
      array (
        'item' => 
        array (
          'firm_id' => 10082,
          'item_id' => 668,
          'item_name' => 'КОНДИЦИОНЕРЫ - ПРОДАЖА, РЕМОНТ, ОБСЛУЖИВАНИЕ',
        ),
      ),
      12 => 
      array (
        'item' => 
        array (
          'firm_id' => 10082,
          'item_id' => 828,
          'item_name' => 'ХОЛОДИЛЬНОЕ ОБОРУДОВАНИЕ',
        ),
      ),
      13 => 
      array (
        'item' => 
        array (
          'firm_id' => 3819,
          'item_id' => 619,
          'item_name' => 'ГРУЗОВЫЕ ПЕРЕВОЗКИ АВТОТРАНСПОРТОМ',
        ),
      ),
      14 => 
      array (
        'item' => 
        array (
          'firm_id' => 5901,
          'item_id' => 556,
          'item_name' => 'АВТОЗАПЧАСТИ ДЛЯ ГРУЗОВОГО ТРАНСПОРТА',
        ),
      ),
      15 => 
      array (
        'item' => 
        array (
          'firm_id' => 5901,
          'item_id' => 117,
          'item_name' => 'ГОРНО - ШАХТНОЕ ОБОРУДОВАНИЕ',
        ),
      ),
      16 => 
      array (
        'item' => 
        array (
          'firm_id' => 5901,
          'item_id' => 619,
          'item_name' => 'ГРУЗОВЫЕ ПЕРЕВОЗКИ АВТОТРАНСПОРТОМ',
        ),
      ),
      17 => 
      array (
        'item' => 
        array (
          'firm_id' => 5901,
          'item_id' => 397,
          'item_name' => 'СЕЛЬХОЗТЕХНИКА - ПРОДАЖА, ЗАПЧАСТИ, РЕМОНТ',
        ),
      ),
      18 => 
      array (
        'item' => 
        array (
          'firm_id' => 5901,
          'item_id' => 401,
          'item_name' => 'СЕРТИФИКАЦИЯ, СТАНДАРТИЗАЦИЯ',
        ),
      ),
      19 => 
      array (
        'item' => 
        array (
          'firm_id' => 5901,
          'item_id' => 773,
          'item_name' => 'СПЕЦТЕХНИКА - ПРОДАЖА, ЗАПЧАСТИ, РЕМОНТ',
        ),
      ),
      20 => 
      array (
        'item' => 
        array (
          'firm_id' => 5901,
          'item_id' => 774,
          'item_name' => 'СПЕЦТЕХНИКА - УСЛУГИ',
        ),
      ),
      21 => 
      array (
        'item' => 
        array (
          'firm_id' => 8090,
          'item_id' => 453,
          'item_name' => 'ТОРГОВЫЕ ДОМА, ЦЕНТРЫ',
        ),
      ),
      22 => 
      array (
        'address' => 
        array (
          'firm_id' => 3819,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'Пограничная',
          'building' => '56',
          'office' => NULL,
        ),
      ),
      23 => 
      array (
        'phone' => 
        array (
          'phone_id' => 6864,
          'firm_id' => 8090,
          'phone_type' => 1,
          'phone_code' => '7222',
          'phone_number' => '523900',
          'phone_description' => '',
        ),
      ),
      24 => 
      array (
        'phone' => 
        array (
          'phone_id' => 10641,
          'firm_id' => 3819,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '492113',
          'phone_description' => '',
        ),
      ),
      25 => 
      array (
        'phone' => 
        array (
          'phone_id' => 11038,
          'firm_id' => 10082,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '524146',
          'phone_description' => '',
        ),
      ),
      26 => 
      array (
        'phone' => 
        array (
          'phone_id' => 12366,
          'firm_id' => 5901,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '752046',
          'phone_description' => '',
        ),
      ),
      27 => 
      array (
        'phone' => 
        array (
          'phone_id' => 12761,
          'firm_id' => 9291,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '766620',
          'phone_description' => '',
        ),
      ),
    ),
  ),
)</pre></body><html>