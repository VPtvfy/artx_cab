<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body><pre>array (
  'item' => '441',
  'town' => '2',
  'keyword' => '',
  'user' => 'guest',
  'new_firm_id' => 0,
  'new_firm_name' => '',
  'new_firm_item_name' => '',
  'query_str' => false,
)<hr>array (
  0 => 
  array (
    'query' => 'select distinct c.item_id,c.item_pid,if (char_length(c.item_name)>3,concat(substr(c.item_name,1,1),lower(substr(c.item_name,2,64))),c.item_name) item_name,c.`count`,c.`stat`
  from catalog_tree c1
 inner join catalog_tree c2 on c2.id=c1.pid and c1.id=?
 inner join catalog_tree c3 on c3.id=c2.pid
 inner join catalog_tree c4 on c4.id=c3.pid
 inner join vcatalog c on c.item_pid=c1.id or c.item_id=c1.id or c.item_id=c2.id or c.item_id=c3.id or c.item_id=c4.id
 where c.`count`>0 or c.stat>0
 order by if(c.item_id=0,1,0),c.item_pid,c.item_name;',
    'values' => 
    array (
      0 => 'd',
      1 => '441',
    ),
    'affected_rows' => 11,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 1,
    'field_count' => 5,
    'Execution time' => 0.2890620231628418,
    'Transfer time' => 0,
  ),
  1 => 
  array (
    'query' => 'set @keylist = ucase(?)',
    'values' => 
    array (
      0 => 's',
      1 => false,
    ),
    'affected_rows' => 0,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 1,
    'field_count' => 0,
    'Execution time' => 0.21875,
    'Transfer time' => 0,
  ),
  2 => 
  array (
    'query' => 'set @key=\'\'',
    'values' => 
    array (
    ),
    'affected_rows' => 0,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 0,
    'Execution time' => 0.2109379768371582,
    'Transfer time' => 0,
  ),
  3 => 
  array (
    'query' => 'create temporary table keywords
select @key:=substr(@keylist,1,instr(concat(@keylist,\'|\'),\'|\')-1) keyword,
       @keylist:=substr(@keylist,instr(concat(@keylist,\'|\'),\'|\')+1,255) dummy
  from  firm
 where @keylist!=\'\'',
    'values' => 
    array (
    ),
    'affected_rows' => 0,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 0,
    'Execution time' => 0.2265620231628418,
    'Transfer time' => 0,
  ),
  4 => 
  array (
    'query' => 'delete from keywords where char_length(keyword)<3',
    'values' => 
    array (
    ),
    'affected_rows' => 0,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 0,
    'Execution time' => 0.2109379768371582,
    'Transfer time' => 0,
  ),
  5 => 
  array (
    'query' => 'create temporary table fresult
as
select max(if(char_length(?)<3,1,relevance(upper(?),concat_ws(\' \',firm_name,item_name,address,phone)))) as relevance,               
               firm_id
          from vfirm
          left join keywords k on concat_ws(\' \',firm_name,item_name,address,phone) like concat(\'%\',k.keyword,\'%\')
         where (town_id=? or ?=0)
           and (item_id=? or ?=0)
           and (char_length(?)<3 or k.keyword is not null)
 group by firm_id
having max(if(char_length(?)<3,1,relevance(upper(?),concat_ws(\' \',firm_name,item_name,address,phone))))>0
 order by 1 desc
 limit 100; ',
    'values' => 
    array (
      0 => 'ssddddsss',
      1 => false,
      2 => false,
      3 => '2',
      4 => '2',
      5 => '441',
      6 => '441',
      7 => false,
      8 => false,
      9 => false,
    ),
    'affected_rows' => 12,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 9,
    'field_count' => 0,
    'Execution time' => 0.2265620231628418,
    'Transfer time' => 0,
  ),
  6 => 
  array (
    'query' => 'select f.*
  from fresult r
 inner join firm f on f.firm_id=r.firm_id
order by r.relevance desc,f.firm_name;',
    'values' => 
    array (
    ),
    'affected_rows' => 12,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 3,
    'Execution time' => 0.2109379768371582,
    'Transfer time' => 0,
  ),
  7 => 
  array (
    'query' => 'select r.firm_id,c.*
  from fresult r
 inner join firm_div d on d.firm_id=r.firm_id
 inner join catalog_item c on c.item_id=d.item_id',
    'values' => 
    array (
    ),
    'affected_rows' => 23,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 3,
    'Execution time' => 0.21875,
    'Transfer time' => 0,
  ),
  8 => 
  array (
    'query' => 'SELECT r.firm_id,t.town_name, s.street_name, CONCAT (a.building,bletter) building,  CONCAT (a.office,oletter) office
  from fresult r
 INNER JOIN firm_address a ON a.firm_id=r.firm_id
 INNER JOIN street s ON a.street_id=s.street_id
 INNER JOIN town t ON s.town_id=t.town_id
order by 2,3,4,5',
    'values' => 
    array (
    ),
    'affected_rows' => 12,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 5,
    'Execution time' => 0.21875,
    'Transfer time' => 0,
  ),
  9 => 
  array (
    'query' => 'select p.*
  from fresult r
 inner join firm_phone p on p.firm_id=r.firm_id
order by phone_code,phone_number;',
    'values' => 
    array (
    ),
    'affected_rows' => 15,
    'insert_id' => 0,
    'num_rows' => 0,
    'param_count' => 0,
    'field_count' => 6,
    'Execution time' => 0.2109370231628418,
    'Transfer time' => 0,
  ),
)<hr>array (
  'sync' => 
  array (
    0 => 
    array (
      'items' => 'true',
    ),
    1 => 
    array (
      'firms' => 'true',
    ),
  ),
  'state' => 
  array (
    'item' => '441',
    'town' => '2',
    'keyword' => '',
    'user' => 'guest',
    'new_firm_id' => 0,
    'new_firm_name' => '',
    'new_firm_item_name' => '',
    'query_str' => false,
  ),
  'nodes' => 
  array (
    'catalog' => 
    array (
      0 => 
      array (
        'item' => 
        array (
          'item_id' => 1,
          'item_pid' => 0,
          'item_name' => 'Автомобили',
          'count' => 12,
          'stat' => 0,
        ),
      ),
      1 => 
      array (
        'item' => 
        array (
          'item_id' => 22,
          'item_pid' => 0,
          'item_name' => 'Транспорт',
          'count' => 7,
          'stat' => 0,
        ),
      ),
      2 => 
      array (
        'item' => 
        array (
          'item_id' => 24,
          'item_pid' => 0,
          'item_name' => 'Услуги',
          'count' => 53,
          'stat' => 0,
        ),
      ),
      3 => 
      array (
        'item' => 
        array (
          'item_id' => 46,
          'item_pid' => 1,
          'item_name' => 'Автоперевозки',
          'count' => 4,
          'stat' => 0,
        ),
      ),
      4 => 
      array (
        'item' => 
        array (
          'item_id' => 47,
          'item_pid' => 1,
          'item_name' => 'Автоуслуги',
          'count' => 5,
          'stat' => 1,
        ),
      ),
      5 => 
      array (
        'item' => 
        array (
          'item_id' => 41,
          'item_pid' => 22,
          'item_name' => 'Авто',
          'count' => 13,
          'stat' => 0,
        ),
      ),
      6 => 
      array (
        'item' => 
        array (
          'item_id' => 441,
          'item_pid' => 24,
          'item_name' => 'Такси',
          'count' => 0,
          'stat' => 89,
        ),
      ),
      7 => 
      array (
        'item' => 
        array (
          'item_id' => 441,
          'item_pid' => 41,
          'item_name' => 'Такси',
          'count' => 0,
          'stat' => 89,
        ),
      ),
      8 => 
      array (
        'item' => 
        array (
          'item_id' => 441,
          'item_pid' => 46,
          'item_name' => 'Такси',
          'count' => 0,
          'stat' => 89,
        ),
      ),
      9 => 
      array (
        'item' => 
        array (
          'item_id' => 441,
          'item_pid' => 47,
          'item_name' => 'Такси',
          'count' => 0,
          'stat' => 89,
        ),
      ),
      10 => 
      array (
        'item' => 
        array (
          'item_id' => 0,
          'item_pid' => 0,
          'item_name' => 'Рубрики',
          'count' => 25,
          'stat' => 0,
        ),
      ),
    ),
    'firms' => 
    array (
      0 => 
      array (
        'firm' => 
        array (
          'firm_id' => 38,
          'firm_name' => '22, ТАКСИ',
          'firm_descr' => '',
        ),
      ),
      1 => 
      array (
        'firm' => 
        array (
          'firm_id' => 199,
          'firm_name' => 'APARU, ЕДИНЫЙ CALL - CENTER ТАКСИ',
          'firm_descr' => '',
        ),
      ),
      2 => 
      array (
        'firm' => 
        array (
          'firm_id' => 629,
          'firm_name' => 'DRIVE, ТАКСИ',
          'firm_descr' => '',
        ),
      ),
      3 => 
      array (
        'firm' => 
        array (
          'firm_id' => 1928,
          'firm_name' => 'VIZIT, ТАКСИ',
          'firm_descr' => '',
        ),
      ),
      4 => 
      array (
        'firm' => 
        array (
          'firm_id' => 3925,
          'firm_name' => 'ВОЯЖ, ТАКСИ',
          'firm_descr' => '',
        ),
      ),
      5 => 
      array (
        'firm' => 
        array (
          'firm_id' => 6077,
          'firm_name' => 'КРУИЗ, ТАКСИ',
          'firm_descr' => '',
        ),
      ),
      6 => 
      array (
        'firm' => 
        array (
          'firm_id' => 6177,
          'firm_name' => 'ЛАЙМ, ТАКСИ',
          'firm_descr' => '',
        ),
      ),
      7 => 
      array (
        'firm' => 
        array (
          'firm_id' => 9219,
          'firm_name' => 'ТАЙМ, ТАКСИ',
          'firm_descr' => '',
        ),
      ),
      8 => 
      array (
        'firm' => 
        array (
          'firm_id' => 9222,
          'firm_name' => 'ТАКСИ 600',
          'firm_descr' => '',
        ),
      ),
      9 => 
      array (
        'firm' => 
        array (
          'firm_id' => 9604,
          'firm_name' => 'УДОБНО, ТАКСИ',
          'firm_descr' => '',
        ),
      ),
      10 => 
      array (
        'firm' => 
        array (
          'firm_id' => 9791,
          'firm_name' => 'УСПЕХ, ТАКСИ',
          'firm_descr' => '',
        ),
      ),
      11 => 
      array (
        'firm' => 
        array (
          'firm_id' => 10346,
          'firm_name' => 'ШАТТЛ, ТАКСИ',
          'firm_descr' => '',
        ),
      ),
      12 => 
      array (
        'item' => 
        array (
          'firm_id' => 3925,
          'item_id' => 619,
          'item_name' => 'ГРУЗОВЫЕ ПЕРЕВОЗКИ АВТОТРАНСПОРТОМ',
        ),
      ),
      13 => 
      array (
        'item' => 
        array (
          'firm_id' => 3925,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      14 => 
      array (
        'item' => 
        array (
          'firm_id' => 6077,
          'item_id' => 619,
          'item_name' => 'ГРУЗОВЫЕ ПЕРЕВОЗКИ АВТОТРАНСПОРТОМ',
        ),
      ),
      15 => 
      array (
        'item' => 
        array (
          'firm_id' => 6077,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      16 => 
      array (
        'item' => 
        array (
          'firm_id' => 6177,
          'item_id' => 619,
          'item_name' => 'ГРУЗОВЫЕ ПЕРЕВОЗКИ АВТОТРАНСПОРТОМ',
        ),
      ),
      17 => 
      array (
        'item' => 
        array (
          'firm_id' => 6177,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      18 => 
      array (
        'item' => 
        array (
          'firm_id' => 6177,
          'item_id' => 846,
          'item_name' => 'ЭВАКУАТОРЫ - УСЛУГИ',
        ),
      ),
      19 => 
      array (
        'item' => 
        array (
          'firm_id' => 9219,
          'item_id' => 619,
          'item_name' => 'ГРУЗОВЫЕ ПЕРЕВОЗКИ АВТОТРАНСПОРТОМ',
        ),
      ),
      20 => 
      array (
        'item' => 
        array (
          'firm_id' => 9219,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      21 => 
      array (
        'item' => 
        array (
          'firm_id' => 9219,
          'item_id' => 846,
          'item_name' => 'ЭВАКУАТОРЫ - УСЛУГИ',
        ),
      ),
      22 => 
      array (
        'item' => 
        array (
          'firm_id' => 9222,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      23 => 
      array (
        'item' => 
        array (
          'firm_id' => 9604,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      24 => 
      array (
        'item' => 
        array (
          'firm_id' => 9791,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      25 => 
      array (
        'item' => 
        array (
          'firm_id' => 38,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      26 => 
      array (
        'item' => 
        array (
          'firm_id' => 10346,
          'item_id' => 619,
          'item_name' => 'ГРУЗОВЫЕ ПЕРЕВОЗКИ АВТОТРАНСПОРТОМ',
        ),
      ),
      27 => 
      array (
        'item' => 
        array (
          'firm_id' => 10346,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      28 => 
      array (
        'item' => 
        array (
          'firm_id' => 10346,
          'item_id' => 846,
          'item_name' => 'ЭВАКУАТОРЫ - УСЛУГИ',
        ),
      ),
      29 => 
      array (
        'item' => 
        array (
          'firm_id' => 199,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      30 => 
      array (
        'item' => 
        array (
          'firm_id' => 199,
          'item_id' => 846,
          'item_name' => 'ЭВАКУАТОРЫ - УСЛУГИ',
        ),
      ),
      31 => 
      array (
        'item' => 
        array (
          'firm_id' => 629,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      32 => 
      array (
        'item' => 
        array (
          'firm_id' => 1928,
          'item_id' => 619,
          'item_name' => 'ГРУЗОВЫЕ ПЕРЕВОЗКИ АВТОТРАНСПОРТОМ',
        ),
      ),
      33 => 
      array (
        'item' => 
        array (
          'firm_id' => 1928,
          'item_id' => 441,
          'item_name' => 'ТАКСИ',
        ),
      ),
      34 => 
      array (
        'item' => 
        array (
          'firm_id' => 1928,
          'item_id' => 846,
          'item_name' => 'ЭВАКУАТОРЫ - УСЛУГИ',
        ),
      ),
      35 => 
      array (
        'address' => 
        array (
          'firm_id' => 6077,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'Бажова',
          'building' => '521',
          'office' => NULL,
        ),
      ),
      36 => 
      array (
        'address' => 
        array (
          'firm_id' => 629,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'Беспалова',
          'building' => '513',
          'office' => NULL,
        ),
      ),
      37 => 
      array (
        'address' => 
        array (
          'firm_id' => 199,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'К. Кайсенова',
          'building' => '123',
          'office' => NULL,
        ),
      ),
      38 => 
      array (
        'address' => 
        array (
          'firm_id' => 9222,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'Комсомольская',
          'building' => '18',
          'office' => NULL,
        ),
      ),
      39 => 
      array (
        'address' => 
        array (
          'firm_id' => 38,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'Крылова',
          'building' => '33',
          'office' => NULL,
        ),
      ),
      40 => 
      array (
        'address' => 
        array (
          'firm_id' => 10346,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'Лихарева',
          'building' => '10',
          'office' => '4',
        ),
      ),
      41 => 
      array (
        'address' => 
        array (
          'firm_id' => 9219,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'Пограничная',
          'building' => '582',
          'office' => '8Б',
        ),
      ),
      42 => 
      array (
        'address' => 
        array (
          'firm_id' => 6177,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'пр. Абая',
          'building' => '20',
          'office' => '610',
        ),
      ),
      43 => 
      array (
        'address' => 
        array (
          'firm_id' => 9604,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'пр. К. Сатпаева',
          'building' => '201',
          'office' => NULL,
        ),
      ),
      44 => 
      array (
        'address' => 
        array (
          'firm_id' => 9791,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'пр. Независимости',
          'building' => '833',
          'office' => NULL,
        ),
      ),
      45 => 
      array (
        'address' => 
        array (
          'firm_id' => 3925,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'пр. Победы',
          'building' => '5',
          'office' => NULL,
        ),
      ),
      46 => 
      array (
        'address' => 
        array (
          'firm_id' => 1928,
          'town_name' => 'Усть-Каменогорск',
          'street_name' => 'Протозанова',
          'building' => '3',
          'office' => NULL,
        ),
      ),
      47 => 
      array (
        'phone' => 
        array (
          'phone_id' => 4732,
          'firm_id' => 9791,
          'phone_type' => 1,
          'phone_code' => '7182',
          'phone_number' => '675050',
          'phone_description' => '',
        ),
      ),
      48 => 
      array (
        'phone' => 
        array (
          'phone_id' => 8995,
          'firm_id' => 10346,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '227022',
          'phone_description' => '',
        ),
      ),
      49 => 
      array (
        'phone' => 
        array (
          'phone_id' => 9341,
          'firm_id' => 1928,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '244444',
          'phone_description' => '',
        ),
      ),
      50 => 
      array (
        'phone' => 
        array (
          'phone_id' => 9852,
          'firm_id' => 10346,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '259090',
          'phone_description' => '',
        ),
      ),
      51 => 
      array (
        'phone' => 
        array (
          'phone_id' => 11264,
          'firm_id' => 9219,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '531980',
          'phone_description' => '',
        ),
      ),
      52 => 
      array (
        'phone' => 
        array (
          'phone_id' => 11637,
          'firm_id' => 6077,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '555555',
          'phone_description' => '',
        ),
      ),
      53 => 
      array (
        'phone' => 
        array (
          'phone_id' => 11769,
          'firm_id' => 9604,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '573000',
          'phone_description' => '',
        ),
      ),
      54 => 
      array (
        'phone' => 
        array (
          'phone_id' => 11773,
          'firm_id' => 9604,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '573111',
          'phone_description' => '',
        ),
      ),
      55 => 
      array (
        'phone' => 
        array (
          'phone_id' => 11953,
          'firm_id' => 3925,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '579579',
          'phone_description' => '',
        ),
      ),
      56 => 
      array (
        'phone' => 
        array (
          'phone_id' => 11954,
          'firm_id' => 199,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '584111',
          'phone_description' => '',
        ),
      ),
      57 => 
      array (
        'phone' => 
        array (
          'phone_id' => 11986,
          'firm_id' => 9222,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '600600',
          'phone_description' => '',
        ),
      ),
      58 => 
      array (
        'phone' => 
        array (
          'phone_id' => 12178,
          'firm_id' => 38,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '700700',
          'phone_description' => '',
        ),
      ),
      59 => 
      array (
        'phone' => 
        array (
          'phone_id' => 12235,
          'firm_id' => 9604,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '702111',
          'phone_description' => '',
        ),
      ),
      60 => 
      array (
        'phone' => 
        array (
          'phone_id' => 12253,
          'firm_id' => 6177,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '702707',
          'phone_description' => '',
        ),
      ),
      61 => 
      array (
        'phone' => 
        array (
          'phone_id' => 13112,
          'firm_id' => 9219,
          'phone_type' => 1,
          'phone_code' => '7232',
          'phone_number' => '777111',
          'phone_description' => '',
        ),
      ),
    ),
  ),
)</pre></body><html>